<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 580" style="background:#1e1e1e">
  <style>
    .box { fill: none; stroke: #888; stroke-width: 1.5; }
    .box-fill { fill: #2d2d2d; stroke: #888; stroke-width: 1.5; }
    .title-box { fill: none; stroke: #888; stroke-width: 2; }
    .text { font-family: 'Courier New', monospace; fill: #ccc; font-size: 13px; }
    .text-title { font-family: 'Courier New', monospace; fill: #ccc; font-size: 15px; font-weight: bold; }
    .text-small { font-family: 'Courier New', monospace; fill: #888; font-size: 10px; }
    .line { stroke: #888; stroke-width: 1.5; fill: none; }
    .arrow { fill: #888; }
  </style>

  <!-- Outer border -->
  <rect x="20" y="20" width="660" height="540" rx="3" class="title-box"/>

  <!-- Title -->
  <text x="350" y="48" text-anchor="middle" class="text-title">LatentDiffusion3D</text>
  <line x1="40" y1="60" x2="660" y2="60" class="line"/>

  <!-- Input -->
  <rect x="120" y="75" width="460" height="35" rx="3" class="box-fill"/>
  <text x="350" y="98" text-anchor="middle" class="text">Input: 2D Aorta Mask (512x512) from Stage 1</text>

  <!-- Arrow -->
  <line x1="350" y1="110" x2="350" y2="130" class="line"/>
  <polygon points="350,140 345,130 355,130" class="arrow"/>

  <!-- Projection2Dto3D -->
  <rect x="80" y="145" width="540" height="70" rx="3" class="box-fill"/>
  <text x="350" y="168" text-anchor="middle" class="text">Projection2Dto3D</text>
  <text x="100" y="188" class="text-small">2D Conv: (1) -> (64) -> (128)</text>
  <text x="100" y="202" class="text-small">Flatten + Linear: (128x16x16) -> (256x4x4x4)  |  3D Conv: (256) -> (128) -> (latent_dim)</text>

  <!-- Arrow -->
  <line x1="350" y1="215" x2="350" y2="235" class="line"/>
  <polygon points="350,245 345,235 355,235" class="arrow"/>

  <!-- Time Embedding -->
  <rect x="120" y="250" width="460" height="45" rx="3" class="box-fill"/>
  <text x="350" y="273" text-anchor="middle" class="text">Time Embedding</text>
  <text x="350" y="288" text-anchor="middle" class="text-small">Linear(1) -> SiLU -> Linear -> (latent_dim)</text>

  <!-- Arrow -->
  <line x1="350" y1="295" x2="350" y2="315" class="line"/>
  <polygon points="350,325 345,315 355,315" class="arrow"/>

  <!-- UNet3DConditioned -->
  <rect x="80" y="330" width="540" height="70" rx="3" class="box-fill"/>
  <text x="350" y="353" text-anchor="middle" class="text">UNet3DConditioned (Denoiser)</text>
  <text x="100" y="373" class="text-small">Encoder: Down blocks with skip connections</text>
  <text x="100" y="387" class="text-small">Middle: Conv + SpatialTransformer3D + Conv  |  Decoder: Up blocks with skip concatenation</text>

  <!-- Arrow with label -->
  <line x1="350" y1="400" x2="350" y2="420" class="line"/>
  <polygon points="350,430 345,420 355,420" class="arrow"/>
  <text x="420" y="418" class="text-small">(iterate T -> 0)</text>

  <!-- VAE3D Decoder -->
  <rect x="120" y="435" width="460" height="45" rx="3" class="box-fill"/>
  <text x="350" y="458" text-anchor="middle" class="text">VAE3D Decoder (frozen)</text>
  <text x="350" y="473" text-anchor="middle" class="text-small">Latent (8^3) -> 3D Volume (128^3)</text>

  <!-- Arrow -->
  <line x1="350" y1="480" x2="350" y2="500" class="line"/>
  <polygon points="350,510 345,500 355,500" class="arrow"/>

  <!-- Output -->
  <rect x="120" y="515" width="460" height="35" rx="3" class="box-fill"/>
  <text x="350" y="538" text-anchor="middle" class="text">Output: 3D Aorta Volume (128x128x128)</text>
</svg>
