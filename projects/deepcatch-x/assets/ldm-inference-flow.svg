<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 520" style="background:#1e1e1e">
  <style>
    .box { fill: none; stroke: #888; stroke-width: 1.5; }
    .box-fill { fill: #2d2d2d; stroke: #888; stroke-width: 1.5; }
    .title-box { fill: none; stroke: #888; stroke-width: 2; }
    .text { font-family: 'Courier New', monospace; fill: #ccc; font-size: 13px; }
    .text-title { font-family: 'Courier New', monospace; fill: #ccc; font-size: 15px; font-weight: bold; }
    .text-small { font-family: 'Courier New', monospace; fill: #888; font-size: 10px; }
    .line { stroke: #888; stroke-width: 1.5; fill: none; }
    .arrow { fill: #888; }
  </style>

  <!-- Outer border -->
  <rect x="20" y="20" width="710" height="480" rx="3" class="title-box"/>

  <!-- Title -->
  <text x="375" y="48" text-anchor="middle" class="text-title">INFERENCE FLOW (generate_3d_sample)</text>
  <line x1="40" y1="60" x2="710" y2="60" class="line"/>

  <!-- Input boxes side by side -->
  <rect x="100" y="80" width="150" height="45" rx="3" class="box-fill"/>
  <text x="175" y="100" text-anchor="middle" class="text">2D Aorta</text>
  <text x="175" y="117" text-anchor="middle" class="text-small">(from Stage 1)</text>

  <rect x="500" y="80" width="150" height="45" rx="3" class="box-fill"/>
  <text x="575" y="100" text-anchor="middle" class="text">Random Noise</text>
  <text x="575" y="117" text-anchor="middle" class="text-small">z_T ~ N(0,I)</text>

  <!-- Arrows down -->
  <line x1="175" y1="125" x2="175" y2="155" class="line"/>
  <polygon points="175,165 170,155 180,155" class="arrow"/>

  <!-- Projection2Dto3D -->
  <rect x="100" y="170" width="150" height="40" rx="3" class="box-fill"/>
  <text x="175" y="195" text-anchor="middle" class="text">Projection2Dto3D</text>

  <!-- Lines merging -->
  <line x1="175" y1="210" x2="175" y2="230" class="line"/>
  <line x1="575" y1="125" x2="575" y2="230" class="line"/>
  <line x1="175" y1="230" x2="375" y2="230" class="line"/>
  <line x1="575" y1="230" x2="375" y2="230" class="line"/>
  <line x1="375" y1="230" x2="375" y2="250" class="line"/>
  <polygon points="375,260 370,250 380,250" class="arrow"/>

  <!-- Iterative Denoising Box -->
  <rect x="100" y="265" width="550" height="100" rx="3" class="box-fill"/>
  <text x="375" y="290" text-anchor="middle" class="text">Iterative Denoising (T=1000 -> t=0)</text>
  <text x="130" y="320" class="text-small">for t in [T, T-1, ..., 1, 0]:</text>
  <text x="150" y="340" class="text-small">e_theta = UNet3DConditioned(z_t, t, condition)</text>
  <text x="150" y="355" class="text-small">z_{t-1} = denoise_step(z_t, e_theta, t)</text>

  <!-- Arrow -->
  <line x1="375" y1="365" x2="375" y2="385" class="line"/>
  <polygon points="375,395 370,385 380,385" class="arrow"/>

  <!-- Denoised Latent -->
  <text x="375" y="408" text-anchor="middle" class="text">Denoised Latent z_0</text>

  <!-- Arrow -->
  <line x1="375" y1="415" x2="375" y2="430" class="line"/>
  <polygon points="375,440 370,430 380,430" class="arrow"/>

  <!-- VAE3D Decoder -->
  <rect x="150" y="445" width="450" height="40" rx="3" class="box-fill"/>
  <text x="375" y="460" text-anchor="middle" class="text">VAE3D Decoder</text>
  <text x="375" y="478" text-anchor="middle" class="text-small">z_0 -> Linear -> Reshape(256,8,8,8) -> ConvT3d layers -> Tanh</text>
</svg>
